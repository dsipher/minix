#!/bin/sh -

# All calls to awk removed, because Minix bawk is deficient.  (kjb)

if [ $# != 2 ]
then
    echo "USAGE: $0 shell.h builtins"
    exit 1
fi
SHL=$1
BLTINS=$2

temp=/tmp/ka$$
exec > builtins.c
cat <<\!
/*
 * This file was generated by the mkbuiltins program.
 */

#include "shell.h"
#include "builtins.h"

!
if grep '^#define JOBS[  ]*1' $SHL > /dev/null
then
    # Job control.
    sed -e '/^#/d
        s/  / /g
        s/ #.*//
        /^ *$/d
        s/-j//' $BLTINS > $temp
else
    # No job control.
    sed -e '/^#/d
        s/  / /g
        s/ #.*//
        /^ *$/d
        /-j/d' $BLTINS > $temp
fi
sed -e 's/ .*//
    s/\(.*\)/int \1();/' $temp
echo '
int (*const builtinfunc[])() = {'
sed -e 's/ .*//
    s/\(.*\)/   \1,/' $temp
echo '};

const struct builtincmd builtincmd[] = {'
i=0
while read line
do
    set -$- $line
    shift
    for fun
    do
        echo "  \"$fun\", $i,"
    done
    i=`expr $i + 1`
done < $temp
echo '  NULL, 0
};'

exec > builtins.h
cat <<\!
/*
 * This file was generated by the mkbuiltins program.
 */

#include <sys/cdefs.h>
!
i=0
tr abcdefghijklmnopqrstuvwxyz ABCDEFGHIJKLMNOPQRSTUVWXYZ < $temp |
    while read line
    do
        set -$- $line
        echo "#define $1 $i"
        i=`expr $i + 1`
    done
echo '
struct builtincmd {
      char *name;
      int code;
};

extern int (*const builtinfunc[])();
extern const struct builtincmd builtincmd[];'
rm -f $temp

# vi: set ts=4 expandtab:
